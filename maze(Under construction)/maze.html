<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dynamic Maze Game</title>
<style>
  body {
    background: #121212;
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
  }
  h2 {
    margin-bottom: 0.5rem;
  }
  #gameContainer {
    margin-top: 1rem;
    display: inline-block;
    border-radius: 15px;
    background: rgba(255,255,255,0.07);
    padding: 1rem;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
  }
  #maze {
    display: grid;
    grid-template-columns: repeat(20, 25px);
    grid-template-rows: repeat(20, 25px);
    gap: 2px;
    user-select: none;
  }
  .cell {
    width: 25px;
    height: 25px;
    border-radius: 5px;
    box-sizing: border-box;
  }
  .wall {
    background: rgba(255, 255, 255, 0.2);
  }
  .path {
    background: rgba(255, 255, 255, 0.05);
  }
  .trap {
    background: rgba(255, 50, 50, 0.8);
  }
  .start {
    background: rgba(100, 255, 100, 0.8);
  }
  .goal {
    background: rgba(50, 150, 255, 0.8);
  }
  .player {
    background: #f0f0f0;
    border: 2px solid #00ffff;
  }
  #info {
    margin-top: 1rem;
    font-size: 1.1rem;
    display: flex;
    gap: 2rem;
    justify-content: center;
    align-items: center;
  }
  #message {
    margin-top: 0.5rem;
    font-weight: bold;
    min-height: 1.2em;
    text-align: center;
  }
  #restartBtn {
    margin-top: 1rem;
    padding: 0.5rem 1.2rem;
    border-radius: 12px;
    background: rgba(133, 133, 133, 0.1);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    cursor: pointer;
    backdrop-filter: blur(15px);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  #restartBtn:hover {
    background: rgba(133, 133, 133, 0.2);
    box-shadow: 0 0 10px #00ffff;
  }
</style>
</head>
<body>

<h2>Dynamic Maze Game</h2>
<div id="gameContainer">
  <div id="maze"></div>
  <div id="info">
    <div>Moves: <span id="moves">0</span></div>
    <div>Time: <span id="timer">0</span> s</div>
  </div>
  <div id="message"></div>
  <button id="restartBtn">Restart Game</button>
</div>

<script>
  // Maze legend:
  // 0 = wall
  // 1 = path
  // 2 = trap
  // 3 = start
  // 4 = goal

  // Multiple maze layouts (20x20)
  const mazes = [
    [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,3,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,4,0],
      [0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0],
      [0,1,0,1,1,1,0,2,0,1,1,1,0,2,1,1,0,1,0,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,1,0,0],
      [0,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,0],
      [0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,0],
      [0,2,1,1,1,1,1,2,0,1,1,1,0,1,0,2,0,1,0,0],
      [0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,0],
      [0,1,1,1,1,0,1,0,2,1,1,1,0,1,1,1,1,1,0,0],
      [0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,0,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0],
      [0,1,1,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0],
      [0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
      [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    ],
    // Second maze variant
    [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,3,1,0,0,1,1,1,1,1,1,0,1,1,1,1,0,1,4,0],
      [0,1,1,0,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,0],
      [0,0,1,1,1,1,0,2,0,0,1,1,1,0,1,1,0,1,0,0],
      [0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,1,0,0],
      [0,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,0],
      [0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,0],
      [0,1,2,1,1,1,1,2,0,1,1,1,0,1,0,2,0,1,0,0],
      [0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,0],
      [0,1,1,1,1,0,1,0,2,1,1,1,0,1,1,1,1,1,0,0],
      [0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0],
      [0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,0],
      [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
      [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    ]
  ];

  const maze = document.getElementById('maze');
  const movesDisplay = document.getElementById('moves');
  const timerDisplay = document.getElementById('timer');
  const messageDisplay = document.getElementById('message');
  const restartBtn = document.getElementById('restartBtn');

  const ROWS = 20;
  const COLS = 20;

  let playerPos = {row: 0, col: 0};
  let moves = 0;
  let seconds = 0;
  let timerInterval;
  let currentMaze;

  function drawMaze() {
    maze.innerHTML = '';
    for(let r=0; r<ROWS; r++) {
      for(let c=0; c<COLS; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        const val = currentMaze[r][c];
        if(val === 0) cell.classList.add('wall');
        else if(val === 1) cell.classList.add('path');
        else if(val === 2) cell.classList.add('trap');
        else if(val === 3) cell.classList.add('start');
        else if(val === 4) cell.classList.add('goal');

        if(r === playerPos.row && c === playerPos.col) {
          cell.classList.add('player');
        }
        maze.appendChild(cell);
      }
    }
  }

  function findPos(value) {
    for(let r=0; r<ROWS; r++) {
      for(let c=0; c<COLS; c++) {
        if(currentMaze[r][c] === value) return {row: r, col: c};
      }
    }
    return null;
  }

  function canMoveTo(r, c) {
    if(r < 0 || c < 0 || r >= ROWS || c >= COLS) return false;
    return currentMaze[r][c] !== 0;
  }

  function resetPlayer() {
    playerPos = findPos(3);
    moves = 0;
    movesDisplay.textContent = moves;
    messageDisplay.textContent = "Oops! You stepped on a trap. Back to start.";
    drawMaze();
  }

  function checkGoal(r, c) {
    if(currentMaze[r][c] === 4) {
      clearInterval(timerInterval);
      messageDisplay.textContent = `ðŸŽ‰ You reached the goal in ${moves} moves and ${seconds} seconds!`;
      document.removeEventListener('keydown', handleKey);
    }
  }

  function handleKey(e) {
    let newRow = playerPos.row;
    let newCol = playerPos.col;

    if(e.key === "ArrowUp" || e.key.toLowerCase() === 'w') newRow--;
    else if(e.key === "ArrowDown" || e.key.toLowerCase() === 's') newRow++;
    else if(e.key === "ArrowLeft" || e.key.toLowerCase() === 'a') newCol--;
    else if(e.key === "ArrowRight" || e.key.toLowerCase() === 'd') newCol++;

    if(canMoveTo(newRow, newCol)) {
      playerPos = {row: newRow, col: newCol};
      moves++;
      movesDisplay.textContent = moves;
      drawMaze();

      if(currentMaze[newRow][newCol] === 2) {
        setTimeout(resetPlayer, 400);
      } else {
        messageDisplay.textContent = "";
      }

      checkGoal(newRow, newCol);
    }
  }

  function startTimer() {
    seconds = 0;
    timerDisplay.textContent = seconds;
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      seconds++;
      timerDisplay.textContent = seconds;
    }, 1000);
  }

  function init() {
    // Pick a random maze layout and clone it deeply to avoid modifying original
    const mazeTemplate = mazes[Math.floor(Math.random() * mazes.length)];
    currentMaze = mazeTemplate.map(row => row.slice());

    // Find all path cells to randomly place start and goal
    const pathCells = [];
    for(let r=0; r<ROWS; r++) {
      for(let c=0; c<COLS; c++) {
        if(currentMaze[r][c] === 1) {
          pathCells.push({row: r, col: c});
        }
      }
    }

    // Remove any existing start and goal from the maze copy
    for(let r=0; r<ROWS; r++) {
      for(let c=0; c<COLS; c++) {
        if(currentMaze[r][c] === 3 || currentMaze[r][c] === 4) {
          currentMaze[r][c] = 1;
        }
      }
    }

    // Pick random distinct start and goal positions from path cells
    const startIndex = Math.floor(Math.random() * pathCells.length);
    let goalIndex;
    do {
      goalIndex = Math.floor(Math.random() * pathCells.length);
    } while(goalIndex === startIndex);

    const startCell = pathCells[startIndex];
    const goalCell = pathCells[goalIndex];

    currentMaze[startCell.row][startCell.col] = 3;
    currentMaze[goalCell.row][goalCell.col] = 4;

    playerPos = {row: startCell.row, col: startCell.col};
    moves = 0;
    messageDisplay.textContent = "";
    movesDisplay.textContent = moves;
    drawMaze();
    startTimer();
    document.addEventListener('keydown', handleKey);
  }

  restartBtn.addEventListener('click', () => {
    messageDisplay.textContent = "";
    document.removeEventListener('keydown', handleKey);
    init();
  });

  // Start on load
  init();
</script>

</body>
</html>
